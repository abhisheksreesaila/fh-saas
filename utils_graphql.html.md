# ğŸ”® GraphQL Client


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## ğŸ¯ Overview

<table>
<colgroup>
<col style="width: 47%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr>
<th>Method</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><a
href="https://abhisheksreesaila.github.io/fh-saas/utils_graphql.html#graphqlclient"><code>GraphQLClient</code></a></td>
<td>GraphQL client with async generator pagination</td>
</tr>
<tr>
<td><code>.from_url()</code></td>
<td>âœ¨ <strong>NEW</strong> - Create client from URL with optional
bearer token</td>
</tr>
<tr>
<td><code>.execute()</code></td>
<td>âœ¨ <strong>NEW</strong> - Unified method for queries and
mutations</td>
</tr>
<tr>
<td><code>.execute_query()</code></td>
<td>Execute single query (returns full response)</td>
</tr>
<tr>
<td><code>.execute_mutation()</code></td>
<td>Execute mutation (alias for execute_query)</td>
</tr>
<tr>
<td><code>.fetch_pages_relay()</code></td>
<td>âœ¨ <strong>NEW</strong> - Fetch all pages from Relay-style
pagination</td>
</tr>
<tr>
<td><code>.fetch_pages_generator()</code></td>
<td>Stream paginated data (memory-efficient)</td>
</tr>
<tr>
<td><a
href="https://abhisheksreesaila.github.io/fh-saas/utils_graphql.html#execute_graphql"><code>execute_graphql()</code></a></td>
<td>âœ¨ <strong>NEW</strong> - One-liner function for simple queries</td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

## ğŸ—ï¸ Architecture

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    Streaming Pagination Flow                    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  Page 1: query($cursor: null) â†’ yield [batch] â†’ process        â”‚
    â”‚  Page 2: query($cursor: xyz)  â†’ yield [batch] â†’ process        â”‚
    â”‚  Page N: query($cursor: abc)  â†’ yield [batch] â†’ process        â”‚
    â”‚                                                                 â”‚
    â”‚  âš ï¸ CRITICAL: Never accumulates full dataset in memory         â”‚
    â”‚  âœ… Memory: O(page_size) not O(total_records)                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

## ğŸ”® GraphQLClient

<table>
<colgroup>
<col style="width: 47%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr>
<th>Method</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.from_url()</code></td>
<td>âœ¨ <strong>NEW</strong> - Create client from URL + token</td>
</tr>
<tr>
<td><code>.execute()</code></td>
<td>âœ¨ <strong>NEW</strong> - Unified query/mutation (returns data
only)</td>
</tr>
<tr>
<td><code>.execute_query()</code></td>
<td>Execute single GraphQL query (full response)</td>
</tr>
<tr>
<td><code>.execute_mutation()</code></td>
<td>Execute GraphQL mutation</td>
</tr>
<tr>
<td><code>.fetch_pages_relay()</code></td>
<td>âœ¨ <strong>NEW</strong> - Auto-accumulate Relay pagination</td>
</tr>
<tr>
<td><code>.fetch_pages_generator()</code></td>
<td>Async generator for paginated data (streaming)</td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

### ğŸš€ Quick Start Examples

#### One-Liner Query

``` python
from fh_saas.utils_graphql import execute_graphql

# NEW: No client management needed
result = await execute_graphql(
    url="https://api.example.com/graphql",
    query="query { users { id name } }",
    bearer_token="your-token"
)
```

#### Convenience Constructor

``` python
from fh_saas.utils_graphql import GraphQLClient

# NEW: Direct from URL
async with GraphQLClient.from_url(
    url="https://api.example.com/graphql",
    bearer_token="your-token"
) as gql:
    result = await gql.execute("query { users { id name } }")
```

#### Relay Pagination (Auto-Accumulate)

``` python
# NEW: Fetch all pages automatically
async with GraphQLClient.from_url(url, bearer_token=token) as gql:
    all_items = await gql.fetch_pages_relay(
        query='''
            query($first: Int, $after: String, $filter: Filter) {
                transactionsConnection(first: $first, after: $after, filter: $filter) {
                    edges { node { id amount } }
                    pageInfo { hasNextPage endCursor }
                }
            }
        ''',
        connection_path="transactionsConnection",
        variables={"filter": {"status": "completed"}},
        page_size=100,
        max_pages=50  # Safety limit
    )
    print(f"Fetched {len(all_items)} total items")
```

#### Legacy: Manual Client Management

``` python
from fh_saas.utils_api import AsyncAPIClient, bearer_token_auth
from fh_saas.utils_graphql import GraphQLClient

# Still supported for advanced use cases
async with AsyncAPIClient(
    'https://api.example.com/graphql',
    auth_headers=bearer_token_auth('TOKEN')
) as http_client:
    
    client = GraphQLClient(http_client)
    result = await client.execute_query(
        query='{ users { id name } }'
    )
```

#### Memory-Efficient Streaming (Generator)

``` python
# For very large datasets - process batches without accumulating
async with GraphQLClient.from_url(url, bearer_token=token) as gql:
    async for batch in gql.fetch_pages_generator(
        query_template='''
            query($cursor: String) {
                users(after: $cursor, first: 1000) {
                    nodes { id name email }
                    pageInfo { hasNextPage endCursor }
                }
            }
        ''',
        variables={'cursor': None},
        items_path=['data', 'users', 'nodes'],
        cursor_path=['data', 'users', 'pageInfo', 'endCursor'],
        has_next_path=['data', 'users', 'pageInfo', 'hasNextPage']
    ):
        print(f"Processing batch of {len(batch)} records")
        # Process immediately - never load full dataset
```

------------------------------------------------------------------------

<a
href="https://github.com/abhisheksreesaila/fh-saas/blob/main/fh_saas/utils_graphql.py#L19"
target="_blank" style="float:right; font-size:smaller">source</a>

### GraphQLClient

``` python

def GraphQLClient(
    api_client:AsyncAPIClient, # Initialized AsyncAPIClient instance
    endpoint:str='', # GraphQL endpoint path (default: '' for base URL)
):

```

*GraphQL client with streaming pagination for memory-efficient data
fetching.*

------------------------------------------------------------------------

<a
href="https://github.com/abhisheksreesaila/fh-saas/blob/main/fh_saas/utils_graphql.py#L22"
target="_blank" style="float:right; font-size:smaller">source</a>

### GraphQLClient.\_\_init\_\_

``` python

def __init__(
    api_client:AsyncAPIClient, # Initialized AsyncAPIClient instance
    endpoint:str='', # GraphQL endpoint path (default: '' for base URL)
):

```

*Initialize self. See help(type(self)) for accurate signature.*

------------------------------------------------------------------------

<a
href="https://github.com/abhisheksreesaila/fh-saas/blob/main/fh_saas/utils_graphql.py#L89"
target="_blank" style="float:right; font-size:smaller">source</a>

### GraphQLClient.execute_query

``` python

def execute_query(
    query:str, # GraphQL query string
    variables:dict=None, # Query variables
)->Dict[str, Any]:

```

*Execute a single GraphQL query and return the JSON response.*

------------------------------------------------------------------------

<a
href="https://github.com/abhisheksreesaila/fh-saas/blob/main/fh_saas/utils_graphql.py#L114"
target="_blank" style="float:right; font-size:smaller">source</a>

### GraphQLClient.execute_mutation

``` python

def execute_mutation(
    mutation:str, # GraphQL mutation string
    variables:dict=None, # Mutation variables
)->Dict[str, Any]:

```

*Execute a GraphQL mutation (alias for execute_query).*

------------------------------------------------------------------------

<a
href="https://github.com/abhisheksreesaila/fh-saas/blob/main/fh_saas/utils_graphql.py#L177"
target="_blank" style="float:right; font-size:smaller">source</a>

### GraphQLClient.fetch_pages_generator

``` python

def fetch_pages_generator(
    query_template:str, # GraphQL query with $variables placeholders
    variables:dict, # Initial variables (must include cursor key)
    items_path:list[str], # JSONPath to list of items (e.g., ['data', 'users', 'nodes'])
    cursor_path:list[str], # JSONPath to next cursor (e.g., ['data', 'users', 'pageInfo', 'endCursor'])
    has_next_path:list[str]=None, # Optional path to hasNextPage boolean (if None, checks cursor != None)
    cursor_var:str='cursor', # Variable name for cursor in query (default: 'cursor')
)->AsyncGenerator[List[Dict], None]:

```

*Stream paginated GraphQL data page-by-page using async generator.*

------------------------------------------------------------------------

<a
href="https://github.com/abhisheksreesaila/fh-saas/blob/main/fh_saas/utils_graphql.py#L122"
target="_blank" style="float:right; font-size:smaller">source</a>

### GraphQLClient.fetch_pages_relay

``` python

def fetch_pages_relay(
    query:str, # GraphQL query with $first and $after variables
    connection_path:str, # Dot-notation path to connection object (e.g., "transactionsConnection")
    variables:dict | None=None, # Base variables for the query (excluding first/after)
    page_size:int=100, # Number of items per page
    max_pages:int | None=None, # Maximum pages to fetch (None for unlimited)
)->list[dict]:

```

*Fetch all pages from a Relay-style paginated GraphQL query.*

Example query structure: query($first: Int, $after: String, $filter:
TransactionFilter) { transactionsConnection(first: $first, after:
$after, filter: $filter) { edges { node { id amount } } pageInfo {
hasNextPage endCursor } } }

Returns: List of all nodes from all pages

------------------------------------------------------------------------

<a
href="https://github.com/abhisheksreesaila/fh-saas/blob/main/fh_saas/utils_graphql.py#L60"
target="_blank" style="float:right; font-size:smaller">source</a>

### GraphQLClient.execute

``` python

def execute(
    query:str, # GraphQL query or mutation string
    variables:dict=None, # Query/mutation variables
)->Dict[str, Any]:

```

*Execute a GraphQL query or mutation and return the data portion.*

This is a unified method that works for both queries and mutations.
Returns only the â€˜dataâ€™ portion of the response for convenience.

------------------------------------------------------------------------

<a
href="https://github.com/abhisheksreesaila/fh-saas/blob/main/fh_saas/utils_graphql.py#L33"
target="_blank" style="float:right; font-size:smaller">source</a>

### GraphQLClient.from_url

``` python

def from_url(
    cls, url:str, # GraphQL endpoint URL
    bearer_token:str | None=None, # Optional bearer token for Authorization header
    headers:dict | None=None, # Optional additional headers
):

```

*Create GraphQL client directly from URL with optional bearer token.*

Usage: async with GraphQLClient.from_url(url, bearer_token=token) as
gql: result = await gql.execute(query)

### Streaming Pagination Details

**Why use generators?** For large datasets (millions of rows),
accumulating all data in memory causes OOM errors. The async generator
yields batches instead.

**Parameters:**

<table>
<colgroup>
<col style="width: 45%" />
<col style="width: 54%" />
</colgroup>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>query_template</code></td>
<td>GraphQL query with <code>$cursor</code> variable</td>
</tr>
<tr>
<td><code>variables</code></td>
<td>Initial variables dict (e.g., <code>{'cursor': None}</code>)</td>
</tr>
<tr>
<td><code>items_path</code></td>
<td>Path to data list in response (e.g.,
<code>['data', 'users', 'nodes']</code>)</td>
</tr>
<tr>
<td><code>cursor_path</code></td>
<td>Path to next cursor (e.g.,
<code>['data', 'users', 'pageInfo', 'endCursor']</code>)</td>
</tr>
<tr>
<td><code>has_next_path</code></td>
<td>Optional path to <code>hasNextPage</code> flag</td>
</tr>
<tr>
<td><code>cursor_var</code></td>
<td>Cursor variable name in query (default: <code>'cursor'</code>)</td>
</tr>
</tbody>
</table>

**Example with database insert:**

``` python
async for batch in client.fetch_pages_generator(
    query_template='''
        query($cursor: String) {
            users(after: $cursor, first: 1000) {
                nodes { id name }
                pageInfo { hasNextPage endCursor }
            }
        }
    ''',
    variables={'cursor': None},
    items_path=['data', 'users', 'nodes'],
    cursor_path=['data', 'users', 'pageInfo', 'endCursor'],
    has_next_path=['data', 'users', 'pageInfo', 'hasNextPage']
):
    # Process each batch immediately
    df = pl.DataFrame(batch)
    df.write_database('staging_table', connection=conn)
```

------------------------------------------------------------------------

<a
href="https://github.com/abhisheksreesaila/fh-saas/blob/main/fh_saas/utils_graphql.py#L234"
target="_blank" style="float:right; font-size:smaller">source</a>

### execute_graphql

``` python

def execute_graphql(
    url:str, # GraphQL endpoint URL
    query:str, # GraphQL query string
    variables:dict | None=None, # Optional query variables
    bearer_token:str | None=None, # Optional bearer token for Authorization header
    headers:dict | None=None, # Optional additional headers
)->dict:

```

*Execute a single GraphQL query without managing client lifecycle.*

This is a convenience function for one-off queries. For multiple
queries, use GraphQLClient.from_url() to reuse the connection.

Usage: result = await execute_graphql(
url=â€œhttps://api.example.com/graphqlâ€, query=â€œquery { users { id name }
}â€, bearer_token=â€œyour-tokenâ€ )

Raises: ValueError: If the response contains GraphQL errors
