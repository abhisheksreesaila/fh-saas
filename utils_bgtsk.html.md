# âš¡ Background Tasks


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## ğŸ¯ Overview

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 40%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr>
<th>Category</th>
<th>Components</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>ğŸ“¦ Model</td>
<td><a
href="https://abhisheksreesaila.github.io/fh-saas/utils_bgtsk.html#tenantjob"><code>TenantJob</code></a></td>
<td>Tenant-level job record with retry support</td>
</tr>
<tr>
<td>âš¡ Manager</td>
<td><a
href="https://abhisheksreesaila.github.io/fh-saas/utils_bgtsk.html#backgroundtaskmanager"><code>BackgroundTaskManager</code></a></td>
<td>Submit, execute, and track background tasks</td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

## ğŸ—ï¸ Architecture

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    FastHTML Route                               â”‚
    â”‚  return response, bg_task  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚                    â”‚
                                  â–¼                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 BackgroundTaskManager                           â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  submit()           â†’ Create job + return BackgroundTask        â”‚
    â”‚  _execute_with_retry() â†’ Run with auto-retry on failure         â”‚
    â”‚  get_job()          â†’ Check job status                          â”‚
    â”‚  list_jobs()        â†’ Query jobs by type/status                 â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  Retry Logic: 2^n seconds backoff (2s, 4s, 8s)                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    Tenant Database                              â”‚
    â”‚                    â””â”€â”€ tenant_jobs table                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

------------------------------------------------------------------------

## ğŸ“š Quick Reference

### Job Status Flow

    pending â†’ running â†’ completed
        â†‘        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â†’ failed (after max retries)

### Usage Pattern

``` python
# In your FastHTML route
manager = BackgroundTaskManager(tenant_db)
job_id, bg_task = manager.submit("sync_data", my_sync_func, user_id="123")
return response, bg_task  # Starlette runs bg_task after response
```

------------------------------------------------------------------------

## ğŸ“¦ TenantJob Model

Tracks background jobs at the tenant level with retry support.

<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>str</td>
<td>Unique job identifier</td>
</tr>
<tr>
<td><code>job_type</code></td>
<td>str</td>
<td>Job category (e.g., â€œsyncâ€, â€œemailâ€)</td>
</tr>
<tr>
<td><code>status</code></td>
<td>str</td>
<td><code>pending</code> / <code>running</code> / <code>completed</code>
/ <code>failed</code></td>
</tr>
<tr>
<td><code>payload</code></td>
<td>str</td>
<td>JSON kwargs passed to task function</td>
</tr>
<tr>
<td><code>result</code></td>
<td>str</td>
<td>JSON result on completion</td>
</tr>
<tr>
<td><code>error_log</code></td>
<td>str</td>
<td>Stack trace on failure</td>
</tr>
<tr>
<td><code>retry_count</code></td>
<td>int</td>
<td>Current retry attempt</td>
</tr>
<tr>
<td><code>max_retries</code></td>
<td>int</td>
<td>Max attempts before marking failed</td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/abhisheksreesaila/fh-saas/blob/main/fh_saas/utils_bgtsk.py#L26"
target="_blank" style="float:right; font-size:smaller">source</a>

### TenantJob

``` python

def TenantJob(
    args:VAR_POSITIONAL, kwargs:VAR_KEYWORD
):

```

*Tenant-level background job with retry support.*

------------------------------------------------------------------------

## âš¡ BackgroundTaskManager

Submit and track background tasks with automatic retry logic.

<table>
<thead>
<tr>
<th>Method</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>submit</code></td>
<td>Create job and return BackgroundTask for Starlette</td>
</tr>
<tr>
<td><code>get_job</code></td>
<td>Get job status and details by ID</td>
</tr>
<tr>
<td><code>list_jobs</code></td>
<td>Query jobs with optional type/status filters</td>
</tr>
</tbody>
</table>

> ğŸ’¡ **Use case**: Long-running operations like syncing data, sending
> emails, or processing uploads

------------------------------------------------------------------------

<a
href="https://github.com/abhisheksreesaila/fh-saas/blob/main/fh_saas/utils_bgtsk.py#L41"
target="_blank" style="float:right; font-size:smaller">source</a>

### BackgroundTaskManager

``` python

def BackgroundTaskManager(
    db:Database
):

```

*Lightweight background task manager for tenant-level operations.*

------------------------------------------------------------------------

<a
href="https://github.com/abhisheksreesaila/fh-saas/blob/main/fh_saas/utils_bgtsk.py#L103"
target="_blank" style="float:right; font-size:smaller">source</a>

### BackgroundTaskManager.list_jobs

``` python

def list_jobs(
    job_type:Optional=None, status:Optional=None, limit:int=100
)->list:

```

*List jobs with optional filtering.*

------------------------------------------------------------------------

<a
href="https://github.com/abhisheksreesaila/fh-saas/blob/main/fh_saas/utils_bgtsk.py#L99"
target="_blank" style="float:right; font-size:smaller">source</a>

### BackgroundTaskManager.get_job

``` python

def get_job(
    job_id:str
)->TenantJob:

```

*Get job status and details.*

------------------------------------------------------------------------

<a
href="https://github.com/abhisheksreesaila/fh-saas/blob/main/fh_saas/utils_bgtsk.py#L49"
target="_blank" style="float:right; font-size:smaller">source</a>

### BackgroundTaskManager.submit

``` python

def submit(
    job_type:str, task_func:Callable, max_retries:int=3, task_kwargs:VAR_KEYWORD
)->tuple:

```

*Submit a new background task for execution.*
